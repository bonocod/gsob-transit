<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GSOB Transit - Book Ticket</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { primary: '#2563EB' }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
</head>
<body class="bg-gray-100">
  <div class="container mx-auto mt-10 px-4">
    <h2 class="text-2xl font-bold mb-6">Book Your Ticket</h2>
    <% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
      <div role="alert" class="bg-red-100 text-red-800 px-4 py-2 mb-4 rounded">
        <%= errorMessage %>
      </div>
    <% } %>
    <form action="/booking" method="POST" aria-label="Booking Form">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <div class="mb-4">
        <label for="name" class="block text-sm font-medium mb-2">Name</label>
        <input type="text" id="name" name="name" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary" value="<%= student && student.name ? student.name : '' %>" readonly aria-readonly="true">
      </div>
      <div class="mb-4">
        <label for="promotion" class="block text-sm font-medium mb-2">Promotion</label>
        <input type="text" id="promotion" name="promotion" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary" value="<%= student && student.promotion ? student.promotion : '' %>" readonly aria-readonly="true">
      </div>
      <% if (student && student.promotion && ['1', '2', '3'].includes(student.promotion)) { %>
        <div class="mb-4">
          <label for="class" class="block text-sm font-medium mb-2">Class</label>
          <select id="class" name="class" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary" required aria-required="true">
            <option value="" <%= !student.class ? 'selected' : '' %>>Select Class</option>
            <option value="A" <%= student.class === 'A' ? 'selected' : '' %>>A</option>
            <option value="B" <%= student.class === 'B' ? 'selected' : '' %>>B</option>
            <option value="C" <%= student.class === 'C' ? 'selected' : '' %>>C</option>
            <option value="D" <%= student.class === 'D' ? 'selected' : '' %>>D</option>
          </select>
        </div>
      <% } else if (student && student.promotion && ['4', '5', '6'].includes(student.promotion)) { %>
        <div class="mb-4">
          <label for="combination" class="block text-sm font-medium mb-2">Combination</label>
          <select id="combination" name="combination" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary" required aria-required="true">
            <option value="" <%= !student.combination ? 'selected' : '' %>>Select Combination</option>
            <option value="MPC" <%= student.combination === 'MPC' ? 'selected' : '' %>>MPC</option>
            <option value="MCB" <%= student.combination === 'MCB' ? 'selected' : '' %>>MCB</option>
            <option value="ANP" <%= student.combination === 'ANP' ? 'selected' : '' %>>ANP</option>
            <option value="PCBa" <%= student.combination === 'PCBa' ? 'selected' : '' %>>PCBa</option>
            <option value="PCBb" <%= student.combination === 'PCBb' ? 'selected' : '' %>>PCBb</option>
            <option value="PCM" <%= student.combination === 'PCM' ? 'selected' : '' %>>PCM</option>
          </select>
        </div>
      <% } %>
      <div class="mb-4">
        <label for="phoneNumber" class="block text-sm font-medium mb-2">Phone Number</label>
        <input type="tel" id="phoneNumber" name="phoneNumber" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary" required aria-required="true" placeholder="Enter phone number">
      </div>
      <div class="mb-4">
        <label for="destination" class="block text-sm font-medium mb-2">Destination</label>
        <select id="destination" name="destination" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary" required aria-required="true">
          <option value="">Select Destination</option>
          <% destinations.forEach(dest => { %>
            <option value="<%= dest._id %>"><%= dest.name %> - <%= dest.price %> RWF</option>
          <% }) %>
        </select>
      </div>
      <div class="mb-4">
        <label for="date" class="block text-sm font-medium mb-2">Date</label>
        <input type="date" id="date" name="date" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary" required aria-required="true" min="<%= new Date().toISOString().split('T')[0] %>">
      </div>
      <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg hover:bg-blue-700 transition">Book Ticket</button>
    </form>
  </div>
</body>
</html>